const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DsaDuelRoom-cZoTlflj.js","assets/vendor-ui-CN8WKm1l.js","assets/vendor-react-Bte3Nn5F.js","assets/index-gDkUcazU.js","assets/index-CiUQ0FYT.css","assets/badge-LuBAZkrR.js","assets/card-BTQvvDTQ.js","assets/tabs-CCYxO0HW.js","assets/textarea-DP-vkoB6.js","assets/dsaProblems-Cqn1Y4EG.js","assets/duelWsUrl-XL3rUy73.js","assets/useDuelUser-BgbJwH0j.js","assets/duelRating-B28zpt2F.js","assets/clock-BcG_Vx7t.js","assets/message-square-C7cMMTjU.js","assets/mic-Ch6e_nuq.js","assets/send-BSpR2Ay_.js","assets/loader-circle-B8r5uqUH.js"])))=>i.map(i=>d[i]);
import{_ as F,y as w,a as L,d as y,A as E,u as m}from"./index-gDkUcazU.js";import{r as d,j as e}from"./vendor-ui-CN8WKm1l.js";import{a as B,L as R}from"./vendor-react-Bte3Nn5F.js";import{C as v,a as k,b as S,d as C,c as I}from"./card-BTQvvDTQ.js";import{g as W}from"./duelWsUrl-XL3rUy73.js";import{u as M}from"./useDuelUser-BgbJwH0j.js";import{g as P,a as U,b as $}from"./duelRating-B28zpt2F.js";import{L as T}from"./loader-circle-B8r5uqUH.js";import{Z as O}from"./zap-D4hAHzvK.js";import{T as z}from"./timer-DKet9El8.js";const b=4,G=4e3;function q(){return typeof window<"u"?window.location.origin:"http://localhost:3001"}function te(){const N=B(),n=M(),[p,f]=d.useState(!1),[r,_]=d.useState(null),[i,h]=d.useState(b),[g,u]=d.useState(!1),o=d.useRef(null),c=d.useRef(null),j=d.useRef(!1);d.useEffect(()=>()=>{c.current&&clearTimeout(c.current),o.current&&(o.current.close(),o.current=null)},[]),d.useEffect(()=>{if(!r)return;if(i<0){const s=new URLSearchParams({opponent:r.opponent,problemId:r.problemId||""});r.isBot&&s.set("bot","1");const t=`/dsa/duels/room/${r.roomId}?${s.toString()}`;F(()=>import("./DsaDuelRoom-cZoTlflj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])).then(()=>{N(t,{replace:!0}),_(null),h(b)});return}if(i===0){const s=setTimeout(()=>h(-1),400);return()=>clearTimeout(s)}const l=setInterval(()=>h(s=>s-1),1e3);return()=>clearInterval(l)},[r,i,N]);const D=(l,s,t,a)=>{j.current||(j.current=!0,c.current&&(clearTimeout(c.current),c.current=null),o.current&&(o.current.close(),o.current=null),f(!1),u(!1),_({roomId:l,opponent:s,problemId:t,isBot:a}),h(b))},A=()=>{if(!n){m.error("Please log in to join duels."),N("/login");return}f(!0),u(!1),j.current=!1,m.info("Finding opponent... (AI match in 4s if no one is online)"),c.current=setTimeout(async()=>{if(c.current=null,!j.current)try{const t=q(),a=await fetch(`${t}/api/duels/bot-match`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gender:n?.gender??void 0})});if(!a.ok)throw new Error("Match failed");const x=await a.json();D(x.roomId,x.opponent||"Opponent",x.problemId||"",x.isBot===!0),m.success(`Matched with ${x.opponent||"Opponent"}. Good luck!`)}catch{f(!1),u(!1),o.current&&(o.current.close(),o.current=null),m.error("Could not start duel",{description:"Start the backend (npm run server) so duels and bot matches work.",duration:8e3})}},G);const l=W(),s=new WebSocket(l);o.current=s,s.onopen=()=>{s.send(JSON.stringify({type:"find_match",userId:n.id??"",username:n.username??"Player",gender:n?.gender??void 0}))},s.onmessage=t=>{try{const a=JSON.parse(t.data);a.type==="queued"?u(!0):a.type==="matched"?D(a.roomId,a.opponent||"Opponent",a.problemId||"",a.isBot===!0):a.type==="error"&&(f(!1),u(!1),c.current&&(clearTimeout(c.current),c.current=null),m.error(a.message||"Matchmaking failed."))}catch{}},s.onerror=()=>{},s.onclose=t=>{t.wasClean||p&&!g&&m.info("Reconnecting via server...")}};return e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 p-6 relative",children:[p&&!r&&e.jsx("div",{className:"fixed inset-0 z-40 flex flex-col items-center justify-center overflow-hidden bg-background/80 backdrop-blur-md",children:e.jsxs("div",{className:"relative flex flex-col items-center text-center px-8 max-w-sm",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"h-20 w-20 rounded-full border-2 border-primary/30 flex items-center justify-center",children:e.jsx(T,{className:"h-10 w-10 text-primary animate-spin"})}),e.jsx("div",{className:"absolute -inset-2 rounded-full border border-primary/20 animate-ping opacity-30"})]}),e.jsx("h3",{className:"text-lg font-semibold mb-1",children:g?"Waiting for opponent":"Finding opponent..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g?"AI opponent in a few seconds if no one joins":"Connecting to matchmaking"}),e.jsx("div",{className:"mt-4 flex gap-1",children:[0,1,2].map(l=>e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/60 animate-pulse",style:{animationDelay:`${l*.2}s`}},l))})]})}),r&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center overflow-hidden bg-gradient-to-br from-background via-background to-primary/5",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_80%_50%_at_50%_-20%,hsl(var(--primary)/0.15),transparent)]"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-[1px]"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center px-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-2",children:[e.jsx(O,{className:"h-5 w-5 animate-pulse"}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wider",children:"Match found"}),e.jsx(O,{className:"h-5 w-5 animate-pulse"})]}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-6 bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text text-transparent",children:"Prepare for duel"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 sm:gap-6 w-full mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1.5 px-4 py-3 rounded-xl bg-muted/60 border border-border/50 shadow-sm",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center overflow-hidden",children:n?.photo?e.jsx("img",{src:n.photo,alt:n.username,className:"h-full w-full rounded-full object-cover"}):e.jsx("span",{className:"text-lg font-bold text-primary",children:n?.username?.slice(0,1)??"Y"})}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[80px]",children:n?.username??"You"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/20 flex items-center justify-center border-2 border-primary/40",children:e.jsx(w,{className:"h-6 w-6 text-primary"})}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground mt-1 uppercase tracking-wider",children:"vs"})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1.5 px-4 py-3 rounded-xl bg-muted/60 border border-border/50 shadow-sm",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-amber-500/20 flex items-center justify-center",children:r.isBot?e.jsx("span",{className:"text-lg font-bold text-amber-600 dark:text-amber-400",children:r.opponent.slice(0,1)}):e.jsx("span",{className:"text-lg font-bold text-amber-600 dark:text-amber-400",children:r.opponent.slice(0,1)})}),e.jsxs("span",{className:"text-sm font-medium truncate max-w-[100px] flex items-center gap-1 justify-center",children:[r.opponent,r.isBot&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-500/20 text-amber-600 dark:text-amber-400 font-medium",children:"AI"})]})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Entering arena in"}),e.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-[3px] border-primary/20",style:{width:100,height:100}}),e.jsx("div",{className:"absolute rounded-full border-[3px] border-t-primary border-r-primary/50 border-b-primary/30 border-l-primary transition-all duration-1000",style:{width:100,height:100,transform:`rotate(${i>0?(b-i)*90:360}deg)`}}),e.jsx("div",{className:"relative flex items-center justify-center w-24 h-24",children:e.jsx("span",{className:"text-4xl sm:text-5xl font-black tabular-nums text-primary drop-shadow-sm",children:i>0?i:"Go!"})})]},i),i>0?e.jsx("p",{className:"text-sm text-muted-foreground animate-pulse",children:i===1?"Get set...":"Get ready..."}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("p",{className:"text-lg font-semibold text-primary flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 animate-spin"}),"Entering arena..."]}),e.jsx("div",{className:"h-1.5 w-40 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full w-full bg-primary rounded-full animate-pulse"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-6 max-w-xs",children:"Same problem, same timer. First correct solution wins."})]})]}),e.jsxs("div",{className:"container max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center justify-center gap-2",children:[e.jsx(w,{className:"h-8 w-8 text-primary"}),"1v1 Duels"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Compete with a random opponent online. Solve the DSA problem first to win and climb the rank."}),n&&(()=>{const l=P(),s=U(l),t=$();return e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium text-primary",children:["Rating: ",e.jsx("span",{className:"tabular-nums",children:l})," Â· ",e.jsxs("span",{className:s.color,children:[s.icon," ",s.name]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.wins,"W / ",t.losses,"L",t.streak>0&&e.jsxs("span",{className:"text-green-500 ml-2",children:["ðŸ”¥ ",t.streak," win streak"]})]})]})})()]}),e.jsxs(v,{children:[e.jsxs(k,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Find opponent"]}),e.jsx(C,{children:"Youâ€™ll be matched with someone online. Same problem, same timer. First correct solution wins."})]}),e.jsxs(I,{className:"space-y-4",children:[n?null:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Log in to join duels and improve your global rank."}),e.jsx(y,{size:"lg",className:"w-full gap-2",onClick:A,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-5 w-5 animate-spin"}),g?"Waiting for opponentâ€¦ (AI soon)":"Finding opponentâ€¦"]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-5 w-5"}),"Find 1v1 match"]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"If no one is online, youâ€™ll be matched with an AI opponent in a few seconds. Room includes: live chat, voice, AI. Winner gets +rank."})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-center",children:"Other ways to practice"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs(v,{className:"hover:border-primary/50 transition-colors",children:[e.jsxs(k,{children:[e.jsxs(S,{className:"text-base flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-primary"}),"Solo Challenge"]}),e.jsx(C,{children:"Timed run, no opponent. Solve a random problem and get a score. No login required."})]}),e.jsx(I,{children:e.jsx(y,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(R,{to:"/dsa/duels/solo",children:"Start solo"})})})]}),e.jsxs(v,{className:"hover:border-primary/50 transition-colors",children:[e.jsxs(k,{children:[e.jsxs(S,{className:"text-base flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-primary"}),"Daily Challenge"]}),e.jsx(C,{children:"One problem per day for everyone. Same challenge, compare times when leaderboard is connected."})]}),e.jsx(I,{children:e.jsx(y,{variant:"outline",className:"w-full",asChild:!0,children:e.jsx(R,{to:"/dsa/duels/daily",children:"Today's challenge"})})})]})]})]})]})]})}export{te as default};
