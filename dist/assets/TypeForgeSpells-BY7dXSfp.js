import{r as n,j as e}from"./vendor-ui-CN8WKm1l.js";import{J as Z,N as J,O as Q,g as S,Q as X,d as h}from"./index-gDkUcazU.js";import{S as Y,a as ee,b as se,c as te,d as ne}from"./select-DoADUCMx.js";import{g as ae}from"./typingPassages-CNQ9HsTr.js";import{M as le,D as re,a as ce,b as ie,c as oe}from"./dialog-0BOb-KT3.js";import{L as de}from"./lock-Djmpukb2.js";import{C as E}from"./clock-BcG_Vx7t.js";import{Z as xe}from"./zap-D4hAHzvK.js";import{R as me}from"./rotate-ccw-DZQtxq7N.js";import"./vendor-react-Bte3Nn5F.js";const he={noob:.8,basic:1.4,pro:2.4},ue={noob:"short",basic:"medium",pro:"long"},fe=[1,3,5,10];function Re(){const[o,U]=n.useState("noob"),[$,q]=n.useState(["noob"]),[u,B]=n.useState(""),[l,T]=n.useState(""),[w,M]=n.useState(0),[r,P]=n.useState(null),[y,H]=n.useState(5),[i,C]=n.useState(null),[d,f]=n.useState(!1),[x,D]=n.useState(!1),k=n.useRef(null),p=n.useRef(),m=n.useRef(0),R=n.useRef(!1),g=n.useRef([]),A=n.useRef(0),j=n.useRef(0),b=n.useCallback(()=>{B(ae(ue[o])),T(""),M(0),P(null),C(null),f(!1),m.current=0,R.current=!1,g.current=[],setTimeout(()=>k.current?.focus(),100)},[o]);n.useEffect(()=>b(),[b]);const N=(r?Date.now()-r:0)/1e3,z=he[o],F=r!==null,_=y*60,L=r!==null&&N>=_;n.useEffect(()=>{if(!F||i||d)return;const s=t=>{m.current===0&&(m.current=t);const a=(t-m.current)/1e3;m.current=t,M(c=>Math.min(u.length,c+z*a))};return p.current=requestAnimationFrame(t=>{m.current=t;const a=c=>{s(c),p.current=requestAnimationFrame(a)};p.current=requestAnimationFrame(a)}),()=>{p.current&&cancelAnimationFrame(p.current)}},[F,z,u.length,i,d]),n.useEffect(()=>{if(!(i||!r)){if(l.length>0){if(w-l.length>12){C("Cursor overtook you. Stay in sync!");return}if(l.length-w>8){C("Too far ahead. Match the cursor rhythm.");return}}L&&!R.current&&(R.current=!0,f(!0),q(s=>{const t=["noob","basic","pro"],a=t.indexOf(o);if(a<0||a>=t.length-1)return s;const c=t[a+1];return s.includes(c)?s:[...s,c]}))}},[w,l.length,i,r,o,L]),j.current=u.slice(0,l.length).split("").filter((s,t)=>s===l[t]).length,A.current=l.length;const G=l.length-j.current,I=l.length>0?Math.round(j.current/l.length*100):100,O=r&&N>0?Math.round(j.current/5/(N/60)):0;n.useEffect(()=>{if(!r||d||i)return;const s=setInterval(()=>{const t=A.current,a=j.current,c=t>0?Math.round(a/t*100):100;g.current.push(c)},1e3);return()=>clearInterval(s)},[r,d,i]),n.useEffect(()=>{if(!x)return;const s=t=>{t.key==="Escape"&&D(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[x]);const K=s=>{!r&&l.length===0&&u.length>0&&P(Date.now())},V=[{id:"noob",label:"Noob"},{id:"basic",label:"Basic"},{id:"pro",label:"Pro"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h1",{className:"text-2xl font-medium text-white",children:"Type Forge"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Test your typing skills and practice here."})]}),e.jsx("div",{className:"h-px bg-white/10"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-cyan-400 mb-1",children:"Spells"}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"Practice typing with syntax highlighting. Timer starts on first key press."}),e.jsx("div",{className:"inline-flex h-10 p-0.5 rounded-lg bg-white/5 border border-white/10 gap-0",children:V.map(({id:s,label:t})=>{const a=!$.includes(s);return e.jsx(Z,{children:e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs("button",{type:"button",onClick:()=>{a||U(s)},className:S("px-4 py-2 text-sm font-semibold rounded-md transition-all duration-150",a&&"cursor-not-allowed opacity-50 text-slate-500",!a&&o===s&&"bg-cyan-500/20 text-cyan-400 border-b-2 border-cyan-400",!a&&o!==s&&"text-slate-400 hover:text-white"),children:[a&&e.jsx(de,{className:"h-3.5 w-3.5 inline mr-1.5"}),t]})}),e.jsx(X,{children:a?"Complete previous level to unlock":t})]})},s)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between flex-wrap gap-2 py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("span",{className:"text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),new Date().toLocaleTimeString("en-US",{hour12:!1})," ",new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-slate-400 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-4 w-4"}),r?`${Math.floor(N/60)}:${String(Math.floor(N%60)).padStart(2,"0")}`:"00:00"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-4 w-4"}),O," WPM"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-4 w-4"}),y," min"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[I,"%"]})]})]}),e.jsx("div",{className:"flex gap-2 mb-2",children:fe.map(s=>e.jsxs(h,{variant:y===s?"default":"outline",size:"sm",className:y===s?"bg-cyan-600 hover:bg-cyan-500":"border-white/20 text-slate-400",onClick:()=>H(s),children:[s," min"]},s))}),e.jsx("div",{className:S(x&&"fixed inset-0 z-50 flex items-center justify-center p-6 bg-[#1A1B22]"),children:e.jsxs("div",{className:S("rounded-xl border border-white/10 bg-[#1E2026] overflow-hidden",x&&"w-full max-w-4xl max-h-[90vh] flex flex-col"),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-white/10",children:[e.jsxs(Y,{value:"english",onValueChange:()=>{},children:[e.jsx(ee,{className:"w-[120px] h-8 bg-transparent border-white/20 text-slate-300 text-sm",children:e.jsx(se,{placeholder:"English"})}),e.jsx(te,{children:e.jsx(ne,{value:"english",children:"English"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-sm",children:[e.jsx("span",{className:"text-cyan-400",children:"Spells"}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:b,children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>D(!x),children:e.jsx(le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:S("relative min-h-[220px] p-4 font-mono text-sm leading-[1.7] cursor-text overflow-auto",x&&"flex-1 min-h-0"),onClick:()=>k.current?.focus(),children:[i&&e.jsxs("div",{className:"absolute inset-0 bg-red-500/10 flex items-center justify-center z-10 rounded-b-xl",children:[e.jsx("p",{className:"text-red-400 font-semibold",children:i}),e.jsx(h,{variant:"outline",size:"sm",className:"ml-4",onClick:b,children:"Retry"})]}),e.jsx("div",{className:"select-none break-all","aria-hidden":!0,children:u.split("").map((s,t)=>{const a=l[t],c=a!==void 0?a===s:null,W=Math.floor(w)===t;let v="text-slate-500";return W?v="bg-cyan-500/30 border-l-2 border-cyan-400":c===!0?v="text-cyan-400":c===!1&&(v="text-red-400 bg-red-500/20"),e.jsx("span",{className:v,children:s===" "?"Â ":s},t)})}),e.jsx("textarea",{ref:k,value:l,onChange:s=>T(s.target.value),onKeyDown:K,className:"absolute inset-0 w-full h-full resize-none bg-transparent text-transparent caret-cyan-400 font-mono text-sm leading-[1.7] p-4 focus:outline-none",style:{zIndex:1},spellCheck:!1,readOnly:!!i||d,"aria-label":"Type the passage"})]})]})})]}),e.jsx(re,{open:d,onOpenChange:s=>!s&&f(!1),children:e.jsxs(ce,{className:"bg-[#1E2026] border-white/10 text-white max-w-md backdrop-blur-sm",children:[e.jsx(ie,{children:e.jsx(oe,{className:"text-cyan-400",children:"Session Complete"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-4xl font-bold text-cyan-400",children:O}),e.jsx("p",{className:"text-slate-400 text-sm",children:"WPM"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"rounded-lg bg-white/5 p-3",children:[e.jsx("p",{className:"text-slate-500",children:"Accuracy"}),e.jsxs("p",{className:"text-lg font-semibold text-white",children:[I,"%"]})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 p-3",children:[e.jsx("p",{className:"text-slate-500",children:"Errors"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:G})]}),e.jsxs("div",{className:"rounded-lg bg-white/5 p-3 col-span-2",children:[e.jsx("p",{className:"text-slate-500",children:"Characters typed"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:l.length})]})]}),g.current.length>0&&e.jsxs("div",{className:"rounded-lg bg-white/5 p-3",children:[e.jsx("p",{className:"text-slate-500 text-sm mb-2",children:"Accuracy over time"}),e.jsx("div",{className:"h-20 w-full flex items-end gap-0.5",children:g.current.map((s,t)=>e.jsx("div",{className:"flex-1 min-w-0 rounded-t bg-cyan-500/60",style:{height:`${s}%`},title:`${s}%`},t))}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"0s"}),e.jsxs("span",{children:[g.current.length,"s"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(h,{className:"flex-1 bg-cyan-600 hover:bg-cyan-500",onClick:()=>{f(!1),b()},children:"Retry"}),e.jsx(h,{variant:"outline",className:"border-white/20",onClick:()=>f(!1),children:"Close"})]})]})]})})]})}export{Re as default};
