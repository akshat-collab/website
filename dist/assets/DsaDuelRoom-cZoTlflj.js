import{r as a,j as e}from"./vendor-ui-CN8WKm1l.js";import{c as xe,a as ue,d as pe,L as M}from"./vendor-react-Bte3Nn5F.js";import{c as N,u as l,d as c,y as fe,T as he}from"./index-gDkUcazU.js";import{B as ge}from"./badge-LuBAZkrR.js";import{C as D,a as I,b as A,d as O,c as T}from"./card-BTQvvDTQ.js";import{T as je,a as ve,b as L,c as E}from"./tabs-CCYxO0HW.js";import{T as Ne}from"./textarea-DP-vkoB6.js";import{a as ye,g as be}from"./dsaProblems-Cqn1Y4EG.js";import{g as we}from"./duelWsUrl-XL3rUy73.js";import{u as ke}from"./useDuelUser-BgbJwH0j.js";import{c as Se,d as Ce,e as Re,a as F,b as Me}from"./duelRating-B28zpt2F.js";import{C as De}from"./clock-BcG_Vx7t.js";import{M as Ie,B as Z}from"./message-square-C7cMMTjU.js";import{M as ee}from"./mic-Ch6e_nuq.js";import{S as Ae}from"./send-BSpR2Ay_.js";import{L as Oe}from"./loader-circle-B8r5uqUH.js";const Te=N("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Le=N("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const Ee=N("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const Pe=N("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),$e=900;function ss(){const{roomId:d}=xe(),P=ue(),[y]=pe(),[p,se]=a.useState(()=>y.get("opponent")||"Opponent"),$=y.get("problemId");y.get("bot");const h=ke(),x=a.useRef(null),[n,ze]=a.useState(()=>{if($){const t=ye($);if(t)return t}const s=be();return s[Math.floor(Math.random()*s.length)]}),[g,te]=a.useState($e),[o,ae]=a.useState(!1),[u,re]=a.useState(!1),[i,b]=a.useState(null),[ne,z]=a.useState(n?.boilerplate?.javascript??"// Your code"),[V,w]=a.useState([]),[W,Y]=a.useState(""),[f,U]=a.useState(!1),[k,oe]=a.useState(!1),[S,_]=a.useState(!1),[B,j]=a.useState(""),[C,J]=a.useState(!1),[ie,R]=a.useState(!1),[m,q]=a.useState(null),K=a.useRef(!1),G=a.useRef(null);a.useEffect(()=>{d?.trim()||P("/dsa/duels",{replace:!0})},[d,P]),a.useEffect(()=>{n?.boilerplate?.javascript&&z(n.boilerplate.javascript)},[n?.id]),a.useEffect(()=>{if(i||g<=0)return;const s=setInterval(()=>te(t=>t<=1?0:t-1),1e3);return()=>clearInterval(s)},[i]),a.useEffect(()=>{if(!(!i||K.current))if(K.current=!0,i==="you"){const s=Se(p);q({newRating:s,change:Ce()})}else{const s=Re(p);q({newRating:s,change:-5})}},[i,p]),a.useEffect(()=>{g===0&&!i&&(b(o===u?null:o?"you":"opponent"),o!==u&&l.info(o?"Time's up! You won.":"Time's up! Opponent won."))},[g,i,o,u]);const le=()=>{o||(ae(!0),u||b("you"),x.current?.readyState===WebSocket.OPEN&&x.current.send(JSON.stringify({type:"solved"})),l.success("Correct! You solved it first."))};a.useEffect(()=>{if(!d)return;const s=we(),t=new WebSocket(s);return x.current=t,t.onopen=()=>{t.send(JSON.stringify({type:"join_room",roomId:d,userId:h?.id??"",username:h?.username??"You",gender:h?.gender??void 0})),R(!0)},t.onmessage=v=>{try{const r=JSON.parse(v.data);if(r.type==="room_joined"&&r.botName)se(r.botName);else if(r.type==="chat"){if(r.from==="me")return;w(X=>[...X,{id:`m-${Date.now()}-${X.length}`,from:"opponent",text:r.text,time:r.time?new Date(r.time):new Date}])}else r.type==="opponent_solved"?(re(!0),o||b("opponent"),l.info("Opponent solved first!")):r.type==="opponent_left"?l.info(`${r.username||"Opponent"} left the duel.`):r.type==="error"&&l.error(r.message||"Connection error.")}catch{}},t.onclose=()=>R(!1),t.onerror=()=>R(!1),()=>{t.close(),x.current=null}},[d]);const H=()=>{const s=W.trim();s&&(x.current?.readyState===WebSocket.OPEN?(x.current.send(JSON.stringify({type:"chat",text:s,roomId:d??void 0})),w(t=>[...t,{id:`m-${Date.now()}`,from:"me",text:s,time:new Date}])):w(t=>[...t,{id:`m-${Date.now()}`,from:"me",text:s,time:new Date}]),Y(""))},ce=()=>{f?U(!1):(U(!0),l.info("Voice connected (demo). Real VC requires backend."))},de=async()=>{if(S){G.current?.stop(),_(!1),l.success("Recording saved (demo).");return}try{const s=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(s);G.current=t,t.start(),_(!0),l.info("Recording started.")}catch{l.error("Microphone access needed for recording.")}},Q=async s=>{J(!0),j("");const t=s==="problem"?`Explain this DSA problem briefly: ${n?.title}. ${n?.description?.slice(0,200)}...`:`Give a short approach to solve: ${n?.title}. Don't give full code, just strategy.`;try{const r=await(await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,sessionId:`duel-${d}-ai`,conversationHistory:[]})})).json();r.response?j(r.response):j("AI explanation unavailable. Add GROQ_API_KEY for live explanations.")}catch{j("AI explanation (demo): Use a hash map to store seen values. For each element, check if target - element exists in the map. Connect backend + GROQ_API_KEY for real AI.")}J(!1)},me=s=>{const t=Math.floor(s/60),v=s%60;return`${t}:${String(v).padStart(2,"0")}`};return d?.trim()?n?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-3.5rem)]",children:[e.jsxs("div",{className:"border-b bg-muted/30 px-4 py-2 flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{to:"/dsa/duels",className:"text-sm text-muted-foreground hover:text-foreground",children:"â† Leave duel"}),e.jsxs("span",{className:"font-mono font-semibold flex items-center gap-1",children:[e.jsx(De,{className:"h-4 w-4"}),me(g)]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[ie&&e.jsx("span",{className:"text-xs bg-green-500/20 text-green-600 dark:text-green-400 px-2 py-0.5 rounded font-medium",children:"Live"}),e.jsxs("span",{className:o?"text-green-600 dark:text-green-400 font-medium":"",children:["You ",h?.username??"You"," ",o&&"âœ“"]}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:u?"text-green-600 dark:text-green-400 font-medium":"",children:[p," ",u&&"âœ“"]})]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsxs("div",{className:"w-[70%] min-w-0 border-r overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 shrink-0",children:[e.jsx("h2",{className:"text-lg font-bold",children:n.title}),e.jsx(ge,{variant:"secondary",className:"mt-1",children:n.difficulty}),e.jsxs("div",{className:"mt-4 prose prose-sm dark:prose-invert max-w-none",children:[e.jsx("p",{className:"whitespace-pre-wrap text-foreground",children:n.description}),e.jsx("h3",{className:"font-semibold mt-4",children:"Examples"}),n.examples.slice(0,2).map((s,t)=>e.jsxs("div",{className:"rounded bg-muted/50 p-2 my-2 font-mono text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Input:"})," ",s.input]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Output:"})," ",s.output]})]},t))]})]}),e.jsxs("div",{className:"p-4 pt-0 flex flex-col min-h-0 border-t bg-muted/20",children:[e.jsx(Ne,{value:ne,onChange:s=>z(s.target.value),className:"font-mono text-sm min-h-[200px] flex-1 resize-y",placeholder:"Write your solution..."}),e.jsx(c,{className:"mt-2 gap-2 shrink-0",onClick:le,disabled:o,children:o?"Solved âœ“":"Submit solution"})]})]}),e.jsx("div",{className:"w-[30%] min-w-[240px] flex flex-col border-l bg-muted/10",children:e.jsxs(je,{defaultValue:"chat",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(ve,{className:"mx-2 mt-2 shrink-0 h-8",children:[e.jsxs(L,{value:"chat",className:"gap-1 text-xs px-2",children:[e.jsx(Ie,{className:"h-3.5 w-3.5"}),"Chat"]}),e.jsxs(L,{value:"voice",className:"gap-1 text-xs px-2",children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),"Voice"]}),e.jsxs(L,{value:"ai",className:"gap-1 text-xs px-2",children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),"AI"]})]}),e.jsxs(E,{value:"chat",className:"flex-1 flex flex-col min-h-0 m-0 p-2",children:[e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1.5 border rounded-md p-1.5 bg-muted/20 min-h-0",children:V.length===0?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-3",children:"No messages yet. Say hi!"}):V.map(s=>e.jsxs("div",{className:`text-xs p-1.5 rounded max-w-[95%] ${s.from==="me"?"ml-auto bg-primary/20":"bg-muted/50"}`,children:[e.jsx("span",{className:"font-medium text-[10px] text-muted-foreground",children:s.from==="me"?"You":p}),e.jsx("p",{className:"mt-0.5 break-words",children:s.text})]},s.id))}),e.jsxs("div",{className:"flex gap-1.5 mt-1.5 shrink-0",children:[e.jsx("input",{value:W,onChange:s=>Y(s.target.value),onKeyDown:s=>s.key==="Enter"&&!s.shiftKey&&H(),placeholder:"Type a message...",className:"flex-1 min-w-0 rounded border bg-background px-2 py-1.5 text-xs"}),e.jsx(c,{size:"icon",className:"h-8 w-8 shrink-0",onClick:H,children:e.jsx(Ae,{className:"h-3.5 w-3.5"})})]})]}),e.jsx(E,{value:"voice",className:"flex-1 m-0 p-2 overflow-y-auto",children:e.jsxs(D,{className:"text-sm",children:[e.jsxs(I,{className:"p-3 pb-0",children:[e.jsx(A,{className:"text-sm",children:"Voice & recording"}),e.jsx(O,{className:"text-xs",children:"Join voice (demo). Real 1v1 voice needs WebRTC + backend."})]}),e.jsxs(T,{className:"p-3 flex flex-wrap gap-1.5",children:[e.jsxs(c,{variant:f?"destructive":"default",size:"sm",onClick:ce,className:"gap-1.5 text-xs",children:[f?e.jsx(Pe,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"}),f?"Leave voice":"Join voice"]}),e.jsx(c,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>oe(!k),disabled:!f,title:k?"Unmute":"Mute",children:k?e.jsx(Te,{className:"h-3.5 w-3.5"}):e.jsx(ee,{className:"h-3.5 w-3.5"})}),e.jsxs(c,{variant:S?"destructive":"outline",size:"sm",onClick:de,className:"gap-1.5 text-xs",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),S?"Stop recording":"Start recording"]})]})]})}),e.jsx(E,{value:"ai",className:"flex-1 m-0 p-2 overflow-y-auto",children:e.jsxs(D,{className:"text-sm",children:[e.jsxs(I,{className:"p-3 pb-0",children:[e.jsxs(A,{className:"text-sm flex items-center gap-1.5",children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),"AI explanation"]}),e.jsx(O,{className:"text-xs",children:"Get problem or solution explained by AI."})]}),e.jsxs(T,{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(c,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>Q("problem"),disabled:C,children:"Explain problem"}),e.jsx(c,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>Q("solution"),disabled:C,children:"Explain approach"})]}),C&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1.5",children:[e.jsx(Oe,{className:"h-3.5 w-3.5 animate-spin"}),"AI is thinking..."]}),B&&e.jsx("div",{className:"rounded border bg-muted/20 p-2 text-xs whitespace-pre-wrap max-h-32 overflow-y-auto",children:B})]})]})})]})})]}),i&&(()=>{const s=m?F(m.newRating):F(),t=Me();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur",children:e.jsxs(D,{className:"max-w-sm mx-4",children:[e.jsxs(I,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-6 w-6 text-primary"}),i==="you"?"You win!":"Opponent wins"]}),e.jsx(O,{children:i==="you"?"You solved it first. Keep climbing the ranks!":"Better luck next time. Keep practicing!"}),m&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Rating: ",m.newRating," ",e.jsxs("span",{className:m.change>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:["(",m.change>0?"+":"",m.change,")"]})]}),e.jsxs("p",{className:`text-sm font-semibold ${s.color}`,children:[s.icon," ",s.name]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["W: ",t.wins]}),e.jsxs("span",{children:["L: ",t.losses]}),t.streak>0&&e.jsxs("span",{className:"text-green-500",children:["ðŸ”¥ ",t.streak," streak"]})]})]})]}),e.jsx(T,{children:e.jsx(c,{asChild:!0,className:"w-full",children:e.jsx(M,{to:"/dsa/duels",children:"Back to duels"})})})]})})})()]}):e.jsxs("div",{className:"flex-1 p-6 flex flex-col items-center justify-center gap-3 bg-background",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading problem..."})]}):e.jsxs("div",{className:"flex-1 p-6 flex flex-col items-center justify-center gap-3 bg-background",children:[e.jsx("p",{className:"text-muted-foreground",children:"Invalid room. Redirecting to duels..."}),e.jsx(c,{variant:"outline",asChild:!0,children:e.jsx(M,{to:"/dsa/duels",children:"Back to 1v1 Duels"})})]})}export{ss as default};
